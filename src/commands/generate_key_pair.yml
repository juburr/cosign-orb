description: |
  Generates a Cosign key pair for signing and verification.

  WARNING: This command is intended for development and testing purposes only.
  For production use, store keys securely in a key management system (AWS KMS,
  HashiCorp Vault, GCP KMS, etc.) or at minimum in CircleCI contexts for reuse.
  Keys generated by this command are exported to environment variables and the
  raw key files are securely deleted after export.
parameters:
  password:
    type: string
    description: Password to encrypt the private key. For testing, a simple password is fine. For any real use, use a strong password.
    default: ""
  private_key_var:
    type: string
    description: Environment variable name to store the base64-encoded private key.
    default: COSIGN_PRIVATE_KEY
  public_key_var:
    type: string
    description: Environment variable name to store the base64-encoded public key.
    default: COSIGN_PUBLIC_KEY
  password_var:
    type: string
    description: Environment variable name to store the password.
    default: COSIGN_PASSWORD
steps:
  - run:
      name: Generate Cosign key pair
      environment:
        PARAM_PASSWORD: << parameters.password >>
        PARAM_PRIVATE_KEY_VAR: << parameters.private_key_var >>
        PARAM_PUBLIC_KEY_VAR: << parameters.public_key_var >>
        PARAM_PASSWORD_VAR: << parameters.password_var >>
      command: << include(scripts/generate_key_pair.sh) >>
