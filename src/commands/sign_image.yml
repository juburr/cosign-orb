description: Signs a container image using Cosign.
parameters:
  image:
    type: string
    description: Container image to be signed. Include the full path with the tag at the end.
  private_key:
    type: env_var_name
    description: Base-64 encoded private key.
    default: COSIGN_PRIVATE_KEY
  password:
    type: env_var_name
    description: Password to use the private key.
    default: COSIGN_PASSWORD
  annotations:
    type: string
    description: Comma-separated list of key=value annotations to add to the signature (e.g., "key1=value1,key2=value2").
    default: ""
steps:
  - run:
      name: Sign image
      environment:
        PARAM_IMAGE: << parameters.image >>
        PARAM_PRIVATE_KEY: << parameters.private_key >>
        PARAM_PASSWORD: << parameters.password >>
        PARAM_ANNOTATIONS: << parameters.annotations >>
      command: << include(scripts/sign_image.sh) >>
